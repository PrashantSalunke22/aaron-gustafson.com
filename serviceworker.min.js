const version="v2:",fallback_avatar="/i/fallbacks/avatar.svg",fallback_image="/i/fallbacks/image.svg",offline_image="/i/fallbacks/offline.svg",offline_page="/offline/",preinstall=["/favicon.png",fallback_avatar,fallback_image,offline_image,"/c/default.min.css","/c/advanced.min.css","/j/main.min.js",offline_page],sw_caches={static:{name:"v2:static"},images:{name:"v2:images",limit:75},pages:{name:"v2:pages",limit:5},posts:{name:"v2:posts",limit:10,path:/\/notebook\//},other:{name:"v2:other",limit:50}},ignore=["p.typekit.net/p.gif","www.google-analytics.com/r/collect","ogg","mp3","mp4","ogv","webm","chrome-extension"],high_priority=[/aaron\-gustafson\.com/,/adaptivewebdesign\.info/],avatars=/webmention\.io/,fetch_config={images:{mode:"no-cors"}};function trimCache(e,t){caches.open(e).then(a=>{a.keys().then(n=>{n.length>t&&a.delete(n[0]).then(trimCache(e,t))})})}function saveToCache(e,t,a){caches.open(sw_caches[e].name).then(e=>e.put(t,a))}function refreshCachedCopy(e,t){fetch(e).then(a=>{caches.open(t).then(t=>t.put(e,a))})}function shouldBeIgnored(e){let t=ignore.length;for(;t--;)if(e.indexOf(ignore[t])>-1)return!0;return!1}function isHighPriority(e){let t=high_priority.length;for(;t--;)if(high_priority[t].test(e))return!0;return!1}function respondWithOfflinePage(){return caches.match(offline_page)}function respondWithFallbackImage(e,t=fallback_image){const a=avatars.test(e)?fallback_avatar:t;return caches.match(a)}function respondWithOfflineImage(){return caches.match(offline_image)}self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(e=>Promise.all(e.filter(e=>!e.startsWith("v2:")).map(e=>caches.delete(e)))))}),addEventListener("message",e=>{if("clean up"==e.data){console.log("clean up!");for(let e in sw_caches)void 0!=sw_caches[e].limit&&trimCache(sw_caches[e].name,sw_caches[e].limit)}}),self.addEventListener("fetch",e=>{const t=e.request,a=t.url,n=t.headers.get("save-data");"GET"!==t.method||shouldBeIgnored(a)||(t.headers.get("Accept").includes("text/html")?sw_caches.posts.path.test(a)?e.respondWith(caches.match(t).then(a=>a?(n||e.waitUntil(refreshCachedCopy(t,sw_caches.posts.name)),a):fetch(t).catch(respondWithOfflinePage))):e.respondWith(caches.match(t).then(a=>a?(n||e.waitUntil(refreshCachedCopy(t,sw_caches.pages.name)),a):fetch(t).then(a=>{const n=a.clone();return e.waitUntil(saveToCache("pages",t,n)),a}).catch(respondWithOfflinePage))):t.headers.get("Accept").includes("image")?e.respondWith(caches.match(t).then(s=>s||(isHighPriority(a)?fetch(t,fetch_config.images).then(a=>{const n=a.clone();return e.waitUntil(saveToCache("images",t,n)),a}).catch(respondWithOfflineImage):n?respondFallbackImage(a):fetch(t).then(a=>{const n=a.clone();return e.waitUntil(saveToCache("images",t,n)),a}).catch(function(){return respondFallbackImage(a,offline_image)})))):e.respondWith(caches.match(t).then(a=>a||(n?new Response("",{status:408,statusText:"This request was ignored to save data."}):fetch(t).then(a=>{const n=a.clone();return e.waitUntil(saveToCache("other",t,n)),a}).catch(function(){return new Response("",{status:408,statusText:"The server appears to be offline."})})))))}),self.addEventListener("install",function(e){e.waitUntil(caches.open(sw_caches.static.name).then(function(e){return e.addAll(preinstall)}))});